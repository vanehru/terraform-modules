# RPG Gaming App - Architecture Diagrams

## High-Level Architecture

```
                                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                 â”‚   Internet      â”‚
                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                                          â†“
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚  Static Web App     â”‚
                              â”‚  (Global CDN)       â”‚
                              â”‚  - User Interface   â”‚
                              â”‚  - Game Frontend    â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚ HTTPS
                                         â†“
         â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
         â•‘           Azure Virtual Network (10.0.0.0/16)             â•‘
         â•‘                                                           â•‘
         â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘
         â•‘  â”‚ App Subnet (10.0.1.0/24)                            â”‚ â•‘
         â•‘  â”‚                                                     â”‚ â•‘
         â•‘  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚ â•‘
         â•‘  â”‚   â”‚   Azure Function App      â”‚                    â”‚ â•‘
         â•‘  â”‚   â”‚   - Backend API           â”‚                    â”‚ â•‘
         â•‘  â”‚   â”‚   - VNet Integrated       â”‚                    â”‚ â•‘
         â•‘  â”‚   â”‚   - Managed Identity      â”‚                    â”‚ â•‘
         â•‘  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚ â•‘
         â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘
         â•‘                  â”‚                                       â•‘
         â•‘                  â”‚ Private Network Traffic               â•‘
         â•‘                  â”‚                                       â•‘
         â•‘    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â•‘
         â•‘    â”‚             â”‚             â”‚              â”‚         â•‘
         â•‘    â†“             â†“             â†“              â†“         â•‘
         â•‘                                                          â•‘
         â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘
         â•‘  â”‚Key Vault â”‚ â”‚SQL DB   â”‚ â”‚OpenAI    â”‚ â”‚Storage     â”‚ â•‘
         â•‘  â”‚Subnet    â”‚ â”‚Subnet   â”‚ â”‚Subnet    â”‚ â”‚Subnet      â”‚ â•‘
         â•‘  â”‚10.0.3/24 â”‚ â”‚10.0.4/24â”‚ â”‚10.0.5/24 â”‚ â”‚10.0.2/24   â”‚ â•‘
         â•‘  â”‚          â”‚ â”‚         â”‚ â”‚          â”‚ â”‚            â”‚ â•‘
         â•‘  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â” â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â•‘
         â•‘  â”‚ â”‚  KV  â”‚ â”‚ â”‚ â”‚ SQL â”‚ â”‚ â”‚ â”‚OpenAIâ”‚ â”‚ â”‚ â”‚Storage â”‚â”‚ â•‘
         â•‘  â”‚ â”‚ PE   â”‚ â”‚ â”‚ â”‚ PE  â”‚ â”‚ â”‚ â”‚ PE   â”‚ â”‚ â”‚ â”‚  PE    â”‚â”‚ â•‘
         â•‘  â”‚ â””â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â•‘
         â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘
         â•‘                                                          â•‘
         â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘
         â•‘  â”‚ Deployment Subnet (10.0.6.0/24)                     â”‚ â•‘
         â•‘  â”‚                                                     â”‚ â•‘
         â•‘  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚ â•‘
         â•‘  â”‚   â”‚  Cloud Shell Container       â”‚                 â”‚ â•‘
         â•‘  â”‚   â”‚  - Azure CLI                 â”‚                 â”‚ â•‘
         â•‘  â”‚   â”‚  - func (Functions Core)     â”‚                 â”‚ â•‘
         â•‘  â”‚   â”‚  - git, npm, pip             â”‚                 â”‚ â•‘
         â•‘  â”‚   â”‚  - $5/month cost             â”‚                 â”‚ â•‘
         â•‘  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚ â•‘
         â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘
         â•‘           â†‘                                              â•‘
         â•šâ•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                     â”‚ VNet Relay (Secure Tunnel)
                     â†“
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Azure Cloud Shell â”‚
            â”‚ (shell.azure.com) â”‚
            â”‚ FREE - Microsoft  â”‚
            â”‚ Managed Service   â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†‘
                     â”‚ Browser (HTTPS)
                     â†“
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚Developer â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Legend:
PE = Private Endpoint
All services with PE = No public internet access
```

## Security Layers

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Security Layers                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  Layer 1: Network Isolation                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Private Endpoints - All backend services isolated   â”‚   â”‚
â”‚  â”‚ VNet Integration - Function App inside VNet         â”‚   â”‚
â”‚  â”‚ No Public IPs - Zero internet-facing backend        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                          â†“                                   â”‚
â”‚  Layer 2: Subnet Microsegmentation                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 6 Dedicated Subnets - Service isolation            â”‚   â”‚
â”‚  â”‚ NSG Rules - Traffic control per subnet             â”‚   â”‚
â”‚  â”‚ Service Endpoints - Selective access               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                          â†“                                   â”‚
â”‚  Layer 3: Identity & Access Management                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Managed Identity - Function App â†’ Key Vault        â”‚   â”‚
â”‚  â”‚ RBAC - Least privilege access                      â”‚   â”‚
â”‚  â”‚ Azure AD - Authentication                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                          â†“                                   â”‚
â”‚  Layer 4: Secret Management                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Azure Key Vault - SQL passwords, API keys          â”‚   â”‚
â”‚  â”‚ No Hardcoded Secrets - Runtime retrieval           â”‚   â”‚
â”‚  â”‚ Audit Logs - All access tracked                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                          â†“                                   â”‚
â”‚  Layer 5: Private DNS                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Private DNS Zones - Name resolution                â”‚   â”‚
â”‚  â”‚ No Public DNS - Private IPs only                   â”‚   â”‚
â”‚  â”‚ Automatic Registration - Private endpoint FQDN     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow: User Registration

```
Step 1: User Initiates Registration
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User   â”‚ types username, email on web interface
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
    â”‚ HTTP POST /register
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Static Web App   â”‚ Frontend validation
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚ HTTPS (TLS 1.2+)
    â†“

Step 2: Function App Processing
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Azure Function App                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ 1. Receive request              â”‚ â”‚
â”‚ â”‚ 2. Validate input               â”‚ â”‚
â”‚ â”‚ 3. Authenticate using MSI       â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚ Private Network (VNet)
    â†“

Step 3: Retrieve Credentials from Key Vault
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Azure Key Vault (Private Endpoint)  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ â€¢ Verify Managed Identity       â”‚ â”‚
â”‚ â”‚ â€¢ Check access policy           â”‚ â”‚
â”‚ â”‚ â€¢ Return SQL password           â”‚ â”‚
â”‚ â”‚ â€¢ Return OpenAI API key         â”‚ â”‚
â”‚ â”‚ â€¢ Log access (audit)            â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚ Private IP: 10.0.3.x
    â†“

Step 4: Store User Data in SQL Database
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Azure SQL (Private Endpoint)        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ INSERT INTO Users               â”‚ â”‚
â”‚ â”‚   (Username, Email, CreatedAt)  â”‚ â”‚
â”‚ â”‚ VALUES (?, ?, GETDATE())        â”‚ â”‚
â”‚ â”‚                                 â”‚ â”‚
â”‚ â”‚ Transaction committed           â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚ Private IP: 10.0.4.x
    â†“

Step 5: Generate Welcome Message with AI
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Azure OpenAI (Private Endpoint)     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Model: GPT-4                    â”‚ â”‚
â”‚ â”‚ Prompt: "Generate welcome       â”‚ â”‚
â”‚ â”‚         message for user..."    â”‚ â”‚
â”‚ â”‚                                 â”‚ â”‚
â”‚ â”‚ Response: "Welcome to the RPG   â”‚ â”‚
â”‚ â”‚           adventure, {user}!"   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚ Private IP: 10.0.5.x
    â†“

Step 6: Return Response
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Function App                        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ {                               â”‚ â”‚
â”‚ â”‚   "success": true,              â”‚ â”‚
â”‚ â”‚   "userId": 12345,              â”‚ â”‚
â”‚ â”‚   "message": "Welcome to the... â”‚ â”‚
â”‚ â”‚ }                               â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚ HTTPS Response
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Static Web App   â”‚ Display success message
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User   â”‚ Sees welcome screen
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Deployment Architecture

```
Developer Workstation
       â”‚
       â”‚ 1. terraform apply
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Terraform Execution â”‚
â”‚ - Creates VNet      â”‚
â”‚ - Creates Subnets   â”‚
â”‚ - Creates PE        â”‚
â”‚ - Creates Services  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ Infrastructure Created
           â†“
    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘ Azure VNet    â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           â”‚
           â”‚ 2. Configure Cloud Shell
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Azure Cloud Shell (Browser) â”‚
â”‚ https://shell.azure.com     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ VNet Relay
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Container Instance          â”‚
â”‚ Subnet: 10.0.6.0/24         â”‚
â”‚ - Azure CLI                 â”‚
â”‚ - func                      â”‚
â”‚ - git, npm, pip             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ 3. Deploy code
           â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”
    â†“      â†“      â†“
Function  Static  Configure
  App     Web App Services
```

## Cost Optimization Comparison

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘              Traditional vs Cloud Shell Approach           â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                            â•‘
â•‘  TRADITIONAL APPROACH                                      â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â•‘
â•‘  â”‚ Azure Bastion                     $140/month     â”‚    â•‘
â•‘  â”‚ - Always-on service                              â”‚    â•‘
â•‘  â”‚ - Charged per hour                               â”‚    â•‘
â•‘  â”‚ - High availability overhead                     â”‚    â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â•‘
â•‘              +                                             â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â•‘
â•‘  â”‚ Virtual Machine (Standard B2s)   $60/month       â”‚    â•‘
â•‘  â”‚ - 2 vCPUs, 4 GB RAM                              â”‚    â•‘
â•‘  â”‚ - Storage costs                                  â”‚    â•‘
â•‘  â”‚ - Maintenance required                           â”‚    â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â•‘
â•‘  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•     â•‘
â•‘  TOTAL: ~$200/month                                       â•‘
â•‘                                                            â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                            â•‘
â•‘  CLOUD SHELL APPROACH âœ¨                                  â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â•‘
â•‘  â”‚ Azure Cloud Shell                FREE             â”‚    â•‘
â•‘  â”‚ - Microsoft-managed service                      â”‚    â•‘
â•‘  â”‚ - Pre-installed tools                            â”‚    â•‘
â•‘  â”‚ - No maintenance                                 â”‚    â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â•‘
â•‘              +                                             â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â•‘
â•‘  â”‚ Container Instance              $5/month         â”‚    â•‘
â•‘  â”‚ - 1 vCPU, 1.5 GB RAM                             â”‚    â•‘
â•‘  â”‚ - Only for VNet relay                            â”‚    â•‘
â•‘  â”‚ - Minimal usage                                  â”‚    â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â•‘
â•‘  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•     â•‘
â•‘  TOTAL: ~$5/month                                         â•‘
â•‘                                                            â•‘
â•‘  ğŸ’° SAVINGS: $195/month (97.5% reduction!)                â•‘
â•‘                                                            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

## Complete Service Topology

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Resource Group                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                            â”‚
â”‚  Virtual Network (10.0.0.0/16)                             â”‚
â”‚  â”œâ”€ Subnet 1: App (10.0.1.0/24)                            â”‚
â”‚  â”œâ”€ Subnet 2: Storage (10.0.2.0/24)                        â”‚
â”‚  â”œâ”€ Subnet 3: Key Vault (10.0.3.0/24)                      â”‚
â”‚  â”œâ”€ Subnet 4: Database (10.0.4.0/24)                       â”‚
â”‚  â”œâ”€ Subnet 5: OpenAI (10.0.5.0/24)                         â”‚
â”‚  â””â”€ Subnet 6: Deployment (10.0.6.0/24)                     â”‚
â”‚                                                            â”‚
â”‚  Private DNS Zones                                         â”‚
â”‚  â”œâ”€ privatelink.vaultcore.azure.net                        â”‚
â”‚  â”œâ”€ privatelink.database.windows.net                       â”‚
â”‚  â”œâ”€ privatelink.blob.core.windows.net                      â”‚
â”‚  â”œâ”€ privatelink.file.core.windows.net                      â”‚
â”‚  â”œâ”€ privatelink.queue.core.windows.net                     â”‚
â”‚  â”œâ”€ privatelink.table.core.windows.net                     â”‚
â”‚  â””â”€ privatelink.openai.azure.com                           â”‚
â”‚                                                            â”‚
â”‚  Compute Resources                                         â”‚
â”‚  â”œâ”€ Static Web App (Global)                                â”‚
â”‚  â”œâ”€ Function App (Linux, Python)                           â”‚
â”‚  â”‚   â”œâ”€ App Service Plan (Consumption)                     â”‚
â”‚  â”‚   â”œâ”€ VNet Integration                                   â”‚
â”‚  â”‚   â””â”€ Managed Identity                                   â”‚
â”‚  â””â”€ Container Instance (Cloud Shell relay)                 â”‚
â”‚                                                            â”‚
â”‚  Storage Resources                                         â”‚
â”‚  â”œâ”€ Storage Account (Function backend)                     â”‚
â”‚  â”‚   â”œâ”€ Blob Container                                     â”‚
â”‚  â”‚   â””â”€ Private Endpoint (10.0.2.x)                        â”‚
â”‚  â””â”€ Storage Account (Cloud Shell)                          â”‚
â”‚      â””â”€ File Share (6 GB)                                  â”‚
â”‚                                                            â”‚
â”‚  Data Resources                                            â”‚
â”‚  â”œâ”€ SQL Server                                             â”‚
â”‚  â”‚   â”œâ”€ SQL Database                                       â”‚
â”‚  â”‚   â”œâ”€ Private Endpoint (10.0.4.x)                        â”‚
â”‚  â”‚   â””â”€ Azure AD Admin                                     â”‚
â”‚  â””â”€ Key Vault                                              â”‚
â”‚      â”œâ”€ Secrets (SQL password, OpenAI key)                 â”‚
â”‚      â”œâ”€ Private Endpoint (10.0.3.x)                        â”‚
â”‚      â””â”€ Access Policies (Function App MSI)                 â”‚
â”‚                                                            â”‚
â”‚  AI Resources                                              â”‚
â”‚  â””â”€ Cognitive Services (OpenAI)                            â”‚
â”‚      â”œâ”€ GPT-4 Deployment                                   â”‚
â”‚      â”œâ”€ GPT-3.5-Turbo Deployment                           â”‚
â”‚      â””â”€ Private Endpoint (10.0.5.x)                        â”‚
â”‚                                                            â”‚
â”‚  Network Resources                                         â”‚
â”‚  â”œâ”€ Private Endpoints (5 total)                            â”‚
â”‚  â”œâ”€ Network Profile (Cloud Shell)                          â”‚
â”‚  â”œâ”€ VNet Links (7 DNS zones)                               â”‚
â”‚  â””â”€ Service Endpoints (Web, SQL)                           â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Total Monthly Cost: ~$30-60 (depending on usage)
Total Resources: ~35 Azure resources
Deployment Time: ~15 minutes
Maintenance: Minimal (managed services)
```

## Network Traffic Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             All Network Traffic Flows                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  Public Traffic (Internet â†’ Azure):                      â”‚
â”‚  User â†’ Static Web App                                   â”‚
â”‚  â”œâ”€ Protocol: HTTPS (TLS 1.2+)                           â”‚
â”‚  â”œâ”€ Port: 443                                            â”‚
â”‚  â””â”€ Location: Global CDN edge                            â”‚
â”‚                                                          â”‚
â”‚  Internal Traffic (Within VNet):                         â”‚
â”‚  Static Web App â†’ Function App                           â”‚
â”‚  â”œâ”€ Protocol: HTTPS                                      â”‚
â”‚  â”œâ”€ Port: 443                                            â”‚
â”‚  â”œâ”€ Source: Internet                                     â”‚
â”‚  â””â”€ Destination: VNet integrated Function                â”‚
â”‚                                                          â”‚
â”‚  Function App â†’ Key Vault                                â”‚
â”‚  â”œâ”€ Protocol: HTTPS                                      â”‚
â”‚  â”œâ”€ Port: 443                                            â”‚
â”‚  â”œâ”€ Source: 10.0.1.x (App Subnet)                        â”‚
â”‚  â”œâ”€ Destination: 10.0.3.x (KV Subnet)                    â”‚
â”‚  â””â”€ Auth: Managed Identity                               â”‚
â”‚                                                          â”‚
â”‚  Function App â†’ SQL Database                             â”‚
â”‚  â”œâ”€ Protocol: TDS (SQL Server)                           â”‚
â”‚  â”œâ”€ Port: 1433                                           â”‚
â”‚  â”œâ”€ Source: 10.0.1.x (App Subnet)                        â”‚
â”‚  â”œâ”€ Destination: 10.0.4.x (DB Subnet)                    â”‚
â”‚  â””â”€ Auth: SQL Auth + AAD                                 â”‚
â”‚                                                          â”‚
â”‚  Function App â†’ Azure OpenAI                             â”‚
â”‚  â”œâ”€ Protocol: HTTPS                                      â”‚
â”‚  â”œâ”€ Port: 443                                            â”‚
â”‚  â”œâ”€ Source: 10.0.1.x (App Subnet)                        â”‚
â”‚  â”œâ”€ Destination: 10.0.5.x (OpenAI Subnet)                â”‚
â”‚  â””â”€ Auth: API Key from Key Vault                         â”‚
â”‚                                                          â”‚
â”‚  Function App â†’ Storage Account                          â”‚
â”‚  â”œâ”€ Protocol: HTTPS                                      â”‚
â”‚  â”œâ”€ Port: 443                                            â”‚
â”‚  â”œâ”€ Source: 10.0.1.x (App Subnet)                        â”‚
â”‚  â”œâ”€ Destination: 10.0.2.x (Storage Subnet)               â”‚
â”‚  â””â”€ Purpose: Function backend (code, logs)               â”‚
â”‚                                                          â”‚
â”‚  Cloud Shell â†’ All Private Endpoints                     â”‚
â”‚  â”œâ”€ Protocol: Various (HTTPS, TDS, etc.)                 â”‚
â”‚  â”œâ”€ Source: 10.0.6.x (Deployment Subnet)                 â”‚
â”‚  â”œâ”€ Destinations: All private IPs                        â”‚
â”‚  â””â”€ Purpose: Deployment and management                   â”‚
â”‚                                                          â”‚
â”‚  âŒ Blocked Traffic:                                     â”‚
â”‚  â”œâ”€ Internet â†’ Key Vault (Default Deny)                  â”‚
â”‚  â”œâ”€ Internet â†’ SQL Database (Public access disabled)     â”‚
â”‚  â”œâ”€ Internet â†’ OpenAI (Public access disabled)           â”‚
â”‚  â”œâ”€ Internet â†’ Storage Account (Default Deny)            â”‚
â”‚  â””â”€ Cross-subnet without explicit rules                  â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
